---
description: 
globs: 
alwaysApply: false
---
# ðŸ—ï¸ zkMed APPLICATION STRUCTURE - HEALTHCARE PLATFORM ARCHITECTURE

**Authority Level**: ðŸ”´ SUPREME - Architectural foundation for zkMed healthcare platform
**Enforcement Status**: ðŸ”’ ACTIVE AND ENFORCING
**Scope**: Universal application structure for zkMed healthcare payment platform

## ðŸ¥ HEALTHCARE DOMAIN ORGANIZATION (MANDATORY)

### **Domain-Driven Directory Structure**
```
src/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ (dashboard)/           # Route groups for role-based access
â”‚   â”‚   â”œâ”€â”€ admin/            # Administrative management
â”‚   â”‚   â”œâ”€â”€ insurance/        # Insurance company operations
â”‚   â”‚   â”œâ”€â”€ hospital/         # Hospital management
â”‚   â”‚   â””â”€â”€ patient/          # Patient interface
â”‚   â””â”€â”€ api/                  # Healthcare API endpoints
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/                   # Atomic design components
â”‚   â”œâ”€â”€ admin/                # Administrative components
â”‚   â”œâ”€â”€ insurance/            # Insurance domain components
â”‚   â”œâ”€â”€ hospital/             # Hospital domain components
â”‚   â”œâ”€â”€ patient/              # Patient domain components
â”‚   â””â”€â”€ shared/               # Cross-domain components
â”œâ”€â”€ hooks/                    # Healthcare-specific custom hooks
â”œâ”€â”€ types/                    # Healthcare domain type definitions
â”œâ”€â”€ lib/                      # Web3, ZK-proof, DeFi utilities
â””â”€â”€ utils/                    # Healthcare utility functions
```

### **Healthcare Role-Based Organization**
Each healthcare domain MUST maintain clear boundaries:

```typescript
// âœ… MANDATORY - Clear domain separation
components/
â”œâ”€â”€ admin/
â”‚   â”œâ”€â”€ OrganizationManager.tsx      # Approve/manage healthcare orgs
â”‚   â”œâ”€â”€ DomainVerification.tsx       # Verify org authenticity
â”‚   â””â”€â”€ AdminDashboard.tsx           # Admin overview
â”œâ”€â”€ insurance/
â”‚   â”œâ”€â”€ PoolManagement.tsx           # DeFi pool operations
â”‚   â”œâ”€â”€ ClaimProcessor.tsx           # Process patient claims
â”‚   â”œâ”€â”€ PatientRegistry.tsx          # Manage patient network
â”‚   â””â”€â”€ HospitalNetwork.tsx          # Manage hospital partnerships
â”œâ”€â”€ hospital/
â”‚   â”œâ”€â”€ PaymentTracker.tsx           # Track insurance payments
â”‚   â”œâ”€â”€ ClaimSubmission.tsx          # Submit patient claims
â”‚   â””â”€â”€ InsurancePartnership.tsx     # Manage insurance relationships
â””â”€â”€ patient/
    â”œâ”€â”€ ReceiptUpload.tsx            # Upload medical receipts
    â”œâ”€â”€ InsuranceConnection.tsx      # Connect to insurance providers
    â””â”€â”€ PaymentHistory.tsx           # View reimbursement history
```

## ðŸ§± ATOMIC DESIGN FOR HEALTHCARE UI (ENFORCED)

### **Component Hierarchy Classification**
```typescript
// Atoms (â‰¤50 lines) - Basic healthcare UI elements
components/ui/
â”œâ”€â”€ MedicalButton.tsx         # Healthcare-themed buttons
â”œâ”€â”€ ClaimBadge.tsx           # Status badges for claims
â”œâ”€â”€ PaymentCard.tsx          # Payment information cards
â””â”€â”€ HealthcareInput.tsx      # Medical form inputs

// Molecules (â‰¤100 lines) - Combined healthcare elements
components/shared/
â”œâ”€â”€ ClaimStatusIndicator.tsx  # Badge + Progress + Status
â”œâ”€â”€ PaymentSummary.tsx       # Amount + Currency + Date
â”œâ”€â”€ UserHealthProfile.tsx    # Avatar + Role + Organization
â””â”€â”€ AssociationRequest.tsx   # Request + Actions + Status

// Organisms (â‰¤150 lines) - Complex healthcare workflows
components/[domain]/
â”œâ”€â”€ ClaimsManagementTable.tsx
â”œâ”€â”€ InsurancePoolDashboard.tsx
â”œâ”€â”€ HospitalPaymentProcessor.tsx
â””â”€â”€ PatientReceiptHandler.tsx
```

### **Healthcare Component Naming Standards**
```typescript
// âœ… MANDATORY - Healthcare-specific naming
// Pattern: [HealthcareDomain][ComponentFunction]
InsuranceClaimProcessor.tsx
HospitalPaymentTracker.tsx
PatientReceiptUploader.tsx
AdminOrganizationManager.tsx

// âœ… MANDATORY - Clear medical context
MedicalReceiptValidator.tsx
HealthcareWalletConnector.tsx
ZKProofMedicalHandler.tsx
DeFiHealthcarePool.tsx
```

## ðŸ”— HEALTHCARE TYPE DEFINITIONS (MANDATORY)

### **Domain-Specific Type Organization**
```typescript
// types/healthcare.ts - Core healthcare entities
interface Patient {
  id: string;
  walletAddress: string;
  insuranceConnections: InsuranceConnection[];
  encryptedMedicalHistory: ZKProofData[];
}

interface Insurance {
  id: string;
  organizationName: string;
  poolAddress: string;
  connectedHospitals: Hospital[];
  managedPatients: Patient[];
}

interface Hospital {
  id: string;
  organizationName: string;
  verifiedDomain: string;
  insurancePartnerships: InsurancePartnership[];
}

// types/blockchain.ts - Web3 and DeFi types
interface HealthcarePool {
  poolAddress: string;
  totalValueLocked: bigint;
  apy: number;
  supportedTokens: ['USDC', 'EURC'];
}

interface ZKProofClaim {
  proofHash: string;
  medicalReceiptHash: string;
  claimAmount: bigint;
  verificationStatus: 'pending' | 'verified' | 'rejected';
}
```

## ðŸŽ¯ HEALTHCARE-SPECIFIC CODING PATTERNS

### **Medical Data Privacy Pattern (MANDATORY)**
```typescript
// âœ… MANDATORY - Always encrypt medical data
interface MedicalRecord {
  id: string;
  patientHash: string;          // Never store direct patient ID
  encryptedData: ZKProofData;   // Always encrypted
  accessPermissions: string[];   // Role-based access
}

// âœ… MANDATORY - ZK-proof integration
const processMedicalClaim = async (receipt: MedicalReceipt) => {
  const zkProof = await generateZKProof(receipt);
  const encryptedReceipt = await encryptMedicalData(receipt);
  return submitClaimWithProof(zkProof, encryptedReceipt);
};
```

### **Healthcare Role-Based Access Control**
```typescript
// âœ… MANDATORY - Role-based component access
interface HealthcareProps {
  userRole: 'admin' | 'insurance' | 'hospital' | 'patient';
  permissions: HealthcarePermission[];
}

const HealthcareDashboard: React.FC<HealthcareProps> = ({ userRole, permissions }) => {
  const canAccessMedicalData = permissions.includes('VIEW_MEDICAL_DATA');
  const canProcessClaims = permissions.includes('PROCESS_CLAIMS');
  
  return (
    <DashboardLayout role={userRole}>
      {canAccessMedicalData && <MedicalDataViewer />}
      {canProcessClaims && <ClaimProcessor />}
    </DashboardLayout>
  );
};
```

### **Web3 Healthcare Integration Pattern**
```typescript
// âœ… MANDATORY - Healthcare-specific Web3 hooks
const useHealthcareWallet = () => {
  const { address, isConnected } = useWallet();
  const userRole = useHealthcareRole(address);
  const permissions = useHealthcarePermissions(userRole);
  
  return {
    address,
    isConnected,
    userRole,
    permissions,
    canAccessMedicalData: permissions.includes('MEDICAL_ACCESS')
  };
};

// âœ… MANDATORY - DeFi pool integration
const useInsurancePool = (insuranceAddress: string) => {
  const poolData = useAavePool(insuranceAddress);
  const yield = usePoolYield(poolData.poolAddress);
  
  return {
    totalLocked: poolData.totalValueLocked,
    currentAPY: yield.apy,
    availableForClaims: poolData.availableBalance,
    recentPayments: poolData.recentTransactions
  };
};
```

## ðŸ“‚ HEALTHCARE FILE ORGANIZATION RULES

### **Co-location for Healthcare Workflows**
```
components/insurance/claim-processing/
â”œâ”€â”€ ClaimProcessor.tsx           # Main component
â”œâ”€â”€ ClaimProcessor.test.tsx      # Component tests
â”œâ”€â”€ ClaimProcessor.types.ts      # Local type definitions
â”œâ”€â”€ ClaimProcessor.hooks.ts      # Component-specific hooks
â””â”€â”€ components/                  # Sub-components
    â”œâ”€â”€ ClaimValidation.tsx
    â”œâ”€â”€ PaymentCalculation.tsx
    â””â”€â”€ ApprovalWorkflow.tsx
```

### **Healthcare-Specific Import Organization**
```typescript
// 1. React and Next.js imports
import React from 'react';
import { NextPage } from 'next';

// 2. Web3 and blockchain libraries
import { ethers } from 'ethers';
import { useWallet } from '@/hooks/useWallet';

// 3. Healthcare-specific utilities
import { generateZKProof } from '@/lib/zkproof';
import { encryptMedicalData } from '@/utils/encryption';
import { validateMedicalReceipt } from '@/utils/validation';

// 4. Healthcare components
import { ClaimProcessor } from '@/components/insurance/ClaimProcessor';
import { MedicalReceiptUploader } from '@/components/patient/MedicalReceiptUploader';

// 5. Healthcare types
import type { Patient, Insurance, MedicalClaim } from '@/types/healthcare';
import type { ZKProofData, HealthcarePool } from '@/types/blockchain';
```

## ðŸ”„ HEALTHCARE WORKFLOW PATTERNS

### **Medical Claim Processing Workflow**
```typescript
// âœ… MANDATORY - End-to-end healthcare workflow
const processHealthcareClaim = async (claim: MedicalClaim) => {
  // 1. Validate medical receipt
  const isValidReceipt = await validateMedicalReceipt(claim.receipt);
  if (!isValidReceipt) throw new Error('Invalid medical receipt');
  
  // 2. Generate zero-knowledge proof
  const zkProof = await generateZKProof(claim.receipt);
  
  // 3. Submit to insurance pool
  const poolResponse = await submitToInsurancePool(claim, zkProof);
  
  // 4. Process payment via DeFi
  const payment = await processPoolPayment(poolResponse);
  
  // 5. Update all stakeholders
  await notifyStakeholders(claim, payment);
  
  return { claim, payment, zkProof };
};
```

### **Healthcare Association Management**
```typescript
// âœ… MANDATORY - Healthcare network management
const manageHealthcareAssociation = async (
  requester: HealthcareEntity,
  target: HealthcareEntity,
  associationType: 'insurance-patient' | 'insurance-hospital' | 'patient-hospital'
) => {
  // Validate association permissions
  const canAssociate = await validateAssociationPermissions(requester, target);
  
  // Create encrypted association request
  const associationRequest = await createEncryptedAssociation(requester, target);
  
  // Submit via blockchain
  const txHash = await submitAssociationRequest(associationRequest);
  
  return { associationRequest, txHash };
};
```

## ðŸ“Š HEALTHCARE QUALITY METRICS

### **Healthcare-Specific File Size Limits**
| Healthcare Component Type | Max Lines | Rationale |
|-----|-----|-----|
| Medical Workflow Components | 200 lines | Complex healthcare processes |
| Insurance Pool Components | 150 lines | DeFi integration complexity |
| Patient Interface Components | 125 lines | User-friendly medical interfaces |
| Admin Management Components | 175 lines | Organization management workflows |
| Healthcare Utility Functions | 100 lines | Medical data processing |

### **Healthcare Security Requirements**
- **Medical Data Encryption**: 100% of medical data must be encrypted
- **ZK-Proof Integration**: All medical claims must use zero-knowledge proofs
- **Role-Based Access**: Healthcare components must implement role-based access
- **Audit Trail**: All medical transactions must be logged and auditable

---

**AUTHORITY LEVEL**: ðŸ”´ **SUPREME AUTHORITY - HEALTHCARE PLATFORM FOUNDATION**  
**ENFORCEMENT STATUS**: ðŸ”’ **ACTIVE AND ENFORCING**  
**SCOPE**: Universal application across zkMed healthcare payment platform
